<!DOCTYPE html>
<html lang="no">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Study Timer</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f4f6f8;
        text-align: center;
        padding: 20px;
    }
    h1 {
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 2em;
        margin-bottom: 20px;
    }
    h1::before {
        content: "⏱️";
        margin-right: 10px;
    }
    .input-container {
        margin: 20px 0;
    }
    textarea {
        padding: 10px;
        width: 90%;
        max-width: 600px;
        height: 150px;
        border: 1px solid #ccc;
        border-radius: 8px;
        font-size: 1em;
        margin-bottom: 10px;
        resize: vertical;
    }
    input[type="number"] {
        padding: 10px;
        width: 100px;
        border: 1px solid #ccc;
        border-radius: 8px;
        font-size: 1em;
        margin-bottom: 10px;
    }
    .btn {
        background-color: #28a745;
        color: white;
        border: none;
        padding: 12px 20px;
        margin: 5px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1em;
    }
    .btn:disabled {
        background-color: #888;
        cursor: not-allowed;
    }
    .info {
        margin-top: 15px;
        font-size: 1.1em;
    }
    .timeline {
        position: relative;
        height: 20px;
        background-color: #ddd;
        border-radius: 10px;
        margin: 30px auto;
        width: 90%;
        max-width: 600px;
        overflow: hidden;
    }
    .progress {
        height: 100%;
        background-color: #28a745;
        border-radius: 10px;
        width: 0%;
        transition: width 0.5s;
    }
    .marker {
        position: absolute;
        top: -8px;
        width: 4px;
        height: 36px;
        background-color: #555;
    }
    .intro, .outro {
        position: absolute;
        top: 0;
        height: 100%;
        background-color: #007bff;
        opacity: 0.3;
    }
    .clock {
        font-size: 1.5em;
        margin-top: 10px;
    }
    .clock.over {
        color: red;
        font-weight: bold;
    }
</style>
</head>
<body>

<h1>Study Timer</h1>

<div class="input-container">
    <label for="articleText">Lim inn teksten fra artikkelen her</label><br>
    <textarea id="articleText" placeholder="Lim inn HELE artikkelteksten her..."></textarea><br>
    <button class="btn" id="analyzeBtn">Analyser</button>
</div>

<div class="input-container">
    <label for="adjustParagraphs">Juster antall avsnitt:</label><br>
    <input type="number" id="adjustParagraphs" min="1">
    <button class="btn" id="adjustBtn">Juster</button>
</div>

<div class="info" id="info">Avsnitt: 0 | Spørsmål: 0 | Les-skriftsteder: 0</div>

<div class="timeline" id="timeline">
    <div class="progress" id="progress"></div>
</div>

<div class="clock" id="clock">00:00</div>

<button class="btn" id="startBtn">Start studiet</button>

<script>
let totalParagraphs = 0;
let questions = 0;
let scriptures = 0;
let startTime;
let timerInterval;

document.getElementById("analyzeBtn").addEventListener("click", () => {
    const text = document.getElementById("articleText").value.trim();
    if (!text) return alert("Lim inn teksten først!");
    analyzeText(text);
});

document.getElementById("startBtn").addEventListener("click", function() {
    if (this.disabled) return;
    this.textContent = "Studiet er i gang";
    this.disabled = true;
    startClock();
});

document.getElementById("adjustBtn").addEventListener("click", () => {
    const val = parseInt(document.getElementById("adjustParagraphs").value);
    if (!isNaN(val) && val > 0) {
        totalParagraphs = val;
        updateInfo();
        buildTimelineMarkers();
    }
});

function analyzeText(text) {
    let paragraphs = text.split(/\s\d+\.\s/).slice(1); // hopper over første intro
    totalParagraphs = paragraphs.length;

    questions = (text.match(/\?\s/g) || []).length;
    scriptures = (text.match(/Les\s+[A-ZÆØÅ][a-zæøå]+\s*\d+:\d+/g) || []).length;

    updateInfo();
    buildTimelineMarkers();
}

function updateInfo() {
    document.getElementById("info").textContent =
        `Avsnitt: ${totalParagraphs} | Spørsmål: ${questions} | Les-skriftsteder: ${scriptures}`;
}

function buildTimelineMarkers() {
    const timeline = document.getElementById("timeline");
    timeline.innerHTML = '<div class="progress" id="progress"></div>';

    if (totalParagraphs <= 0) return;

    const totalTime = totalParagraphs * 60 + 90 + 90; // 1,5 min intro + avsnitt + 1,5 min outro

    // Legg inn blå intro
    const intro = document.createElement("div");
    intro.classList.add("intro");
    intro.style.width = `${(90 / totalTime) * 100}%`;
    intro.style.left = "0%";
    timeline.appendChild(intro);

    // Legg inn blå outro
    const outro = document.createElement("div");
    outro.classList.add("outro");
    outro.style.width = `${(90 / totalTime) * 100}%`;
    outro.style.right = "0%";
    timeline.appendChild(outro);

    // Markører for oddetallsavsnitt
    for (let i = 1; i <= totalParagraphs; i++) {
        if (i % 2 === 1) {
            let pos = ( (90 + (i-1)*60) / totalTime ) * 100;
            const marker = document.createElement("div");
            marker.classList.add("marker");
            marker.style.left = `calc(${pos}% - 2px)`;
            timeline.appendChild(marker);
        }
    }
}

function startClock() {
    startTime = Date.now();
    timerInterval = setInterval(() => {
        let elapsed = Math.floor((Date.now() - startTime) / 1000);
        let minutes = String(Math.floor(elapsed / 60)).padStart(2, "0");
        let seconds = String(elapsed % 60).padStart(2, "0");
        const clock = document.getElementById("clock");
        clock.textContent = `${minutes}:${seconds}`;

        let totalTime = totalParagraphs * 60 + 180; // intro+outro
        if (elapsed > totalTime) {
            clock.classList.add("over");
        } else {
            clock.classList.remove("over");
        }

        document.getElementById("progress").style.width = 
            `${Math.min((elapsed / totalTime) * 100, 100)}%`;
    }, 1000);
}
</script>

</body>
</html>
